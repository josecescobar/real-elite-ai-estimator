generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
}

model User {
  id        String     @id @default(cuid())
  email     String     @unique
  name      String
  password  String
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  estimates Estimate[]
  clients   Client[]
  projects  Project[]
}

model Estimate {
  id                String             @id @default(cuid())
  customerName      String
  jobName           String
  address           String             @default("")
  notes             String             @default("")
  description       String             @default("")
  status            String             @default("draft")
  shareToken        String?            @unique
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  userId            String
  user              User               @relation(fields: [userId], references: [id])
  clientId          String?
  client            Client?            @relation(fields: [clientId], references: [id], onDelete: SetNull)
  projectId         String?
  project           Project?           @relation(fields: [projectId], references: [id], onDelete: SetNull)
  lineItems         LineItem[]
  customerResponses CustomerResponse[]
}

model Client {
  id        String     @id @default(cuid())
  name      String
  email     String     @default("")
  phone     String     @default("")
  company   String     @default("")
  address   String     @default("")
  notes     String     @default("")
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  userId    String
  user      User       @relation(fields: [userId], references: [id])
  estimates Estimate[]
}

model Project {
  id          String     @id @default(cuid())
  name        String
  description String     @default("")
  address     String     @default("")
  status      String     @default("active")
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  userId      String
  user        User       @relation(fields: [userId], references: [id])
  estimates   Estimate[]
}

model LineItem {
  id         String   @id @default(cuid())
  name       String
  unit       String   @default("ea")
  qty        Float    @default(1)
  unitCost   Float    @default(0)
  laborHours Float    @default(0)
  laborRate  Float    @default(0)
  markupPct  Float    @default(0)
  sortOrder  Int      @default(0)
  estimateId String
  estimate   Estimate @relation(fields: [estimateId], references: [id], onDelete: Cascade)
}

model CustomerResponse {
  id         String   @id @default(cuid())
  estimateId String
  estimate   Estimate @relation(fields: [estimateId], references: [id], onDelete: Cascade)
  status     String
  message    String   @default("")
  createdAt  DateTime @default(now())
}
